<!DOCTYPE html>
<html lang="vi">
<head>
	<meta charset="UTF-8">
	<title>Key Tool</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			background-color: #000000;
			display: flex;
			justify-content: center;
			align-items: center;
			height: 100vh;
		}
		.container {
			background-color: #ffffff;
			padding: 40px 60px;
			border-radius: 12px;
			box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
			text-align: center;
		}
		#key {
			font-size: 40px;
			font-weight: bold;
			color: #fff;
			margin-bottom: 20px;
			display: inline-block;
			padding: 10px 20px;
			background: #1f1f1f;
			border-radius: 8px;
		}
		#copyBtn {
			background-color: #005EE5;
			color: white;
			border: none;
			padding: 20px 20px;
			font-size: 36px;
			border-radius: 6px;
			cursor: pointer;
		}
		#copyBtn:hover {
			background-color: #f45a04;
		}
	</style>
</head>
<body>
	<div class="container">
		<div id="key">Đang tạo key...</div>
		<button id="copyBtn" onclick="copyKey()">Copy</button>
	</div>

	<script>
		const API_MA = "https://686bea5b14219674dcc69837.mockapi.io/junidokai/keys/keys";
		const keyElement = document.getElementById("key");
		let generatedKey = "";

		function generateKey() {
			const part1 = Math.floor(Math.random() * 9) + 1;
			const part2 = Math.floor(Math.random() * 90) + 10;
			const part3 = Math.floor(Math.random() * 900) + 100;
			const part4 = Math.floor(Math.random() * 9000) + 1000;
			return `MA${part2}DW${part1}JK${part4}WNN${part3}`;
		}

		function uploadKey(key) {
			const data = {
				key: key,
				timestamp: new Date().toISOString()
			};

			fetch(API_MA, {
				method: "POST",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify(data)
			})
			.then(res => res.json())
			.then(result => {
				console.log("Đã tạo key mới:", result);
			})
			.catch(error => {
				console.error("Lỗi khi tạo key:", error);
			});
		}

		function deleteExpiredKeys() {
			fetch(API_MA)
				.then(res => res.json())
				.then(keys => {
					const now = new Date();
					keys.forEach(keyItem => {
						const createdTime = new Date(keyItem.timestamp);
						const timeDiff = now - createdTime;
						if (timeDiff > 24 * 60 * 60 * 1000) {
							fetch(`${API_MA}/${keyItem.id}`, {
								method: "DELETE"
							}).then(() => {
								console.log("Đã xóa key hết hạn:", keyItem.key);
							});
						}
					});
				})
				.catch(err => console.error("Lỗi khi xóa key hết hạn:", err));
		}

		window.onload = () => {
			deleteExpiredKeys(); 
			generatedKey = generateKey();
			keyElement.textContent = generatedKey;
			setTimeout(() => uploadKey(generatedKey), 1000); 
		};

		function copyKey() {
			navigator.clipboard.writeText(generatedKey)
				.then(() => {
					alert("Đã sao chép key: " + generatedKey);
				})
				.catch(err => {
					alert("Không thể sao chép key!");
					console.error(err);
				});
		}
	</script>
</body>
</html>
